// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


model User {
  id          Int      @id @default(autoincrement())
  name        String
  email       String   @unique
  password    String
  role        Role     @default(contestee)
  created_at  DateTime @default(now())

  contests          Contest[]
  mcqSubmissions    McqSubmission[]
  dsaSubmissions    DsaSubmission[]
}

enum Role {
  creator
  contestee
}

model Contest {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  creator_id  Int
  start_time  DateTime
  end_time    DateTime
  created_at  DateTime @default(now())

  creator     User @relation(fields: [creator_id], references: [id])

  mcqs        McqQuestion[]
  dsaProblems DsaProblem[]
}

model McqQuestion {
  id                     Int      @id @default(autoincrement())
  contest_id             Int
  question_text          String
  options                Json     // JSONB
  correct_option_index   Int
  points                 Int      @default(1)
  created_at             DateTime @default(now())

  contest        Contest @relation(fields: [contest_id], references: [id])
  submissions    McqSubmission[]
}

model DsaProblem {
  id           Int      @id @default(autoincrement())
  contest_id   Int
  title        String
  description  String
  tags         Json     // JSONB
  points       Int      @default(100)
  time_limit   Int      @default(2000)
  memory_limit Int      @default(256)
  created_at   DateTime @default(now())

  contest    Contest @relation(fields: [contest_id], references: [id])
  testCases  TestCase[]
  submissions DsaSubmission[]
}

model TestCase {
  id              Int      @id @default(autoincrement())
  problem_id      Int
  input           String
  expected_output String
  is_hidden       Boolean  @default(false)
  created_at      DateTime @default(now())

  problem DsaProblem @relation(fields: [problem_id], references: [id])
}

model McqSubmission {
  id                     Int      @id @default(autoincrement())
  user_id                Int
  question_id            Int
  selected_option_index  Int
  is_correct             Boolean
  points_earned          Int      @default(0)
  submitted_at           DateTime @default(now())

  user     User        @relation(fields: [user_id], references: [id])
  question McqQuestion @relation(fields: [question_id], references: [id])

  @@unique([user_id, question_id])
}

model DsaSubmission {
  id                  Int      @id @default(autoincrement())
  user_id             Int
  problem_id          Int
  code                String
  language            String
  status              String
  points_earned       Int      @default(0)
  test_cases_passed   Int      @default(0)
  total_test_cases    Int      @default(0)
  execution_time      Int?
  submitted_at        DateTime @default(now())

  user    User       @relation(fields: [user_id], references: [id])
  problem DsaProblem @relation(fields: [problem_id], references: [id])
}
